{"ast":null,"code":"import { createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, normalizeClass as _normalizeClass, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, renderList as _renderList, vModelRadio as _vModelRadio, withDirectives as _withDirectives } from \"vue\";\nconst _hoisted_1 = {\n  class: \"container\"\n};\nconst _hoisted_2 = {\n  class: \"status-card card\"\n};\nconst _hoisted_3 = {\n  class: \"text-center\"\n};\nconst _hoisted_4 = {\n  class: \"mb-1\"\n};\nconst _hoisted_5 = {\n  class: \"mb-1\"\n};\nconst _hoisted_6 = {\n  class: \"card\"\n};\nconst _hoisted_7 = {\n  class: \"mb-4\"\n};\nconst _hoisted_8 = [\"value\"];\nconst _hoisted_9 = [\"disabled\"];\nconst _hoisted_10 = {\n  key: 1,\n  class: \"text-center\"\n};\nconst _hoisted_11 = {\n  class: \"queue-number\"\n};\nconst _hoisted_12 = [\"disabled\"];\nconst _hoisted_13 = {\n  class: \"card\"\n};\nconst _hoisted_14 = {\n  class: \"call-container\"\n};\nconst _hoisted_15 = {\n  class: \"call-status\"\n};\nconst _hoisted_16 = {\n  class: \"call-number text-success\"\n};\nconst _hoisted_17 = {\n  class: \"call-status\"\n};\nconst _hoisted_18 = {\n  class: \"call-number text-info\"\n};\nconst _hoisted_19 = {\n  class: \"text-xs text-gray\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_cache[9] || (_cache[9] = _createElementVNode(\"div\", {\n    class: \"title\"\n  }, \"海娜纹身排队\", -1 /* HOISTED */)), _createCommentVNode(\" 当前排队状态 \"), _createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_cache[3] || (_cache[3] = _createElementVNode(\"div\", {\n    class: \"subtitle mb-1\"\n  }, \"当前状态\", -1 /* HOISTED */)), _createElementVNode(\"div\", {\n    class: _normalizeClass(['status-text', _ctx.queueData.hasNumber ? 'active' : ''])\n  }, _toDisplayString(_ctx.queueData.hasNumber ? '排队中' : '未取号'), 3 /* TEXT, CLASS */), _ctx.queueData.hasNumber ? (_openBlock(), _createElementBlock(_Fragment, {\n    key: 0\n  }, [_createElementVNode(\"div\", _hoisted_4, \"您的号码: \" + _toDisplayString(_ctx.queueData.queueNumber), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_5, \"前方等待: \" + _toDisplayString(_ctx.queueData.peopleAhead) + \" 人\", 1 /* TEXT */), _createElementVNode(\"div\", null, \"预计等待: \" + _toDisplayString(_ctx.queueData.waitTime) + \" 分钟\", 1 /* TEXT */)], 64 /* STABLE_FRAGMENT */)) : _createCommentVNode(\"v-if\", true)])]), _createCommentVNode(\" 取号区域 \"), _createElementVNode(\"div\", _hoisted_6, [!_ctx.queueData.hasNumber ? (_openBlock(), _createElementBlock(_Fragment, {\n    key: 0\n  }, [_cache[4] || (_cache[4] = _createElementVNode(\"div\", {\n    class: \"subtitle\"\n  }, \"选择服务\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_7, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.services, item => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: item.id,\n      class: \"radio-item\"\n    }, [_createElementVNode(\"label\", null, [_withDirectives(_createElementVNode(\"input\", {\n      type: \"radio\",\n      value: item.id,\n      \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $data.selectedService = $event)\n    }, null, 8 /* PROPS */, _hoisted_8), [[_vModelRadio, $data.selectedService]]), _createElementVNode(\"span\", null, _toDisplayString(item.name) + \" (约\" + _toDisplayString(item.duration) + \"分钟)\", 1 /* TEXT */)])]);\n  }), 128 /* KEYED_FRAGMENT */))]), _createElementVNode(\"button\", {\n    class: \"btn btn-primary w-full\",\n    onClick: _cache[1] || (_cache[1] = (...args) => $options.getNumber && $options.getNumber(...args)),\n    disabled: $data.loading\n  }, _toDisplayString($data.loading ? '处理中...' : '立即取号'), 9 /* TEXT, PROPS */, _hoisted_9)], 64 /* STABLE_FRAGMENT */)) : (_openBlock(), _createElementBlock(\"div\", _hoisted_10, [_createElementVNode(\"div\", _hoisted_11, _toDisplayString(_ctx.queueData.queueNumber), 1 /* TEXT */), _cache[5] || (_cache[5] = _createElementVNode(\"div\", {\n    class: \"mb-4\"\n  }, \"请留意叫号提醒\", -1 /* HOISTED */)), _createElementVNode(\"button\", {\n    class: \"btn btn-danger\",\n    onClick: _cache[2] || (_cache[2] = (...args) => $options.cancelQueue && $options.cancelQueue(...args)),\n    disabled: $data.loading\n  }, _toDisplayString($data.loading ? '处理中...' : '取消排队'), 9 /* TEXT, PROPS */, _hoisted_12)]))]), _createCommentVNode(\" 当前叫号情况 \"), _createElementVNode(\"div\", _hoisted_13, [_cache[8] || (_cache[8] = _createElementVNode(\"div\", {\n    class: \"subtitle\"\n  }, \"当前叫号\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_14, [_createElementVNode(\"div\", _hoisted_15, [_createElementVNode(\"div\", _hoisted_16, _toDisplayString($data.currentQueue.currentServing || '-'), 1 /* TEXT */), _cache[6] || (_cache[6] = _createElementVNode(\"div\", {\n    class: \"text-sm text-gray\"\n  }, \"正在服务\", -1 /* HOISTED */))]), _createElementVNode(\"div\", _hoisted_17, [_createElementVNode(\"div\", _hoisted_18, _toDisplayString($data.currentQueue.currentWaiting || '-'), 1 /* TEXT */), _cache[7] || (_cache[7] = _createElementVNode(\"div\", {\n    class: \"text-sm text-gray\"\n  }, \"请就位\", -1 /* HOISTED */))])]), _createElementVNode(\"div\", _hoisted_19, \" 今日已服务: \" + _toDisplayString($data.currentQueue.totalServed || 0) + \" 位顾客 \", 1 /* TEXT */)])]);\n}","map":{"version":3,"names":["class","key","_createElementBlock","_hoisted_1","_createElementVNode","_createCommentVNode","_hoisted_2","_hoisted_3","_normalizeClass","_ctx","queueData","hasNumber","_Fragment","_hoisted_4","_toDisplayString","queueNumber","_hoisted_5","peopleAhead","waitTime","_hoisted_6","_hoisted_7","_renderList","$data","services","item","id","type","value","_cache","$event","selectedService","_hoisted_8","name","duration","onClick","args","$options","getNumber","disabled","loading","_hoisted_9","_hoisted_10","_hoisted_11","cancelQueue","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","currentQueue","currentServing","_hoisted_17","_hoisted_18","currentWaiting","_hoisted_19","totalServed"],"sources":["/home/makenumberserver/vue/src/views/Queue.vue"],"sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <div class=\"title\">海娜纹身排队</div>\r\n    \r\n    <!-- 当前排队状态 -->\r\n    <div class=\"status-card card\">\r\n      <div class=\"text-center\">\r\n        <div class=\"subtitle mb-1\">当前状态</div>\r\n        <div :class=\"['status-text', queueData.hasNumber ? 'active' : '']\">\r\n          {{ queueData.hasNumber ? '排队中' : '未取号' }}\r\n        </div>\r\n        <template v-if=\"queueData.hasNumber\">\r\n          <div class=\"mb-1\">您的号码: {{ queueData.queueNumber }}</div>\r\n          <div class=\"mb-1\">前方等待: {{ queueData.peopleAhead }} 人</div>\r\n          <div>预计等待: {{ queueData.waitTime }} 分钟</div>\r\n        </template>\r\n      </div>\r\n    </div>\r\n    \r\n    <!-- 取号区域 -->\r\n    <div class=\"card\">\r\n      <template v-if=\"!queueData.hasNumber\">\r\n        <div class=\"subtitle\">选择服务</div>\r\n        <div class=\"mb-4\">\r\n          <div v-for=\"item in services\" :key=\"item.id\" class=\"radio-item\">\r\n            <label>\r\n              <input \r\n                type=\"radio\" \r\n                :value=\"item.id\" \r\n                v-model=\"selectedService\" \r\n              />\r\n              <span>{{ item.name }} (约{{ item.duration }}分钟)</span>\r\n            </label>\r\n          </div>\r\n        </div>\r\n        <button \r\n          class=\"btn btn-primary w-full\" \r\n          @click=\"getNumber\" \r\n          :disabled=\"loading\"\r\n        >\r\n          {{ loading ? '处理中...' : '立即取号' }}\r\n        </button>\r\n      </template>\r\n      \r\n      <template v-else>\r\n        <div class=\"text-center\">\r\n          <div class=\"queue-number\">{{ queueData.queueNumber }}</div>\r\n          <div class=\"mb-4\">请留意叫号提醒</div>\r\n          <button \r\n            class=\"btn btn-danger\" \r\n            @click=\"cancelQueue\" \r\n            :disabled=\"loading\"\r\n          >\r\n            {{ loading ? '处理中...' : '取消排队' }}\r\n          </button>\r\n        </div>\r\n      </template>\r\n    </div>\r\n    \r\n    <!-- 当前叫号情况 -->\r\n    <div class=\"card\">\r\n      <div class=\"subtitle\">当前叫号</div>\r\n      <div class=\"call-container\">\r\n        <div class=\"call-status\">\r\n          <div class=\"call-number text-success\">{{ currentQueue.currentServing || '-' }}</div>\r\n          <div class=\"text-sm text-gray\">正在服务</div>\r\n        </div>\r\n        <div class=\"call-status\">\r\n          <div class=\"call-number text-info\">{{ currentQueue.currentWaiting || '-' }}</div>\r\n          <div class=\"text-sm text-gray\">请就位</div>\r\n        </div>\r\n      </div>\r\n      <div class=\"text-xs text-gray\">\r\n        今日已服务: {{ currentQueue.totalServed || 0 }} 位顾客\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from 'axios'\r\nimport { mapState } from 'vuex'\r\n\r\nexport default {\r\n  name: 'Queue',\r\n  data() {\r\n    return {\r\n      selectedService: '',\r\n      services: [],\r\n      currentQueue: {\r\n        currentServing: '',\r\n        currentWaiting: '',\r\n        totalServed: 0\r\n      },\r\n      loading: false\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapState(['queueData', 'shopId', 'token'])\r\n  },\r\n  created() {\r\n    this.getServices()\r\n    this.getCurrentQueue()\r\n  },\r\n  mounted() {\r\n    this.$store.dispatch('getQueueStatus', this.shopId)\r\n  },\r\n  methods: {\r\n    // 获取服务列表\r\n    async getServices() {\r\n      try {\r\n        this.loading = true\r\n        const res = await axios.get(`/api/v1/shops/${this.shopId}/services`)\r\n        this.services = res.data.data\r\n        this.selectedService = this.services.length > 0 ? this.services[0].id : ''\r\n      } catch (error) {\r\n        console.error('获取服务列表失败:', error)\r\n        this.$toast('获取服务列表失败')\r\n      } finally {\r\n        this.loading = false\r\n      }\r\n    },\r\n    \r\n    // 获取当前叫号情况\r\n    async getCurrentQueue() {\r\n      try {\r\n        const res = await axios.get('/api/v1/queue/current', {\r\n          params: { shop_id: this.shopId }\r\n        })\r\n        this.currentQueue = res.data.data\r\n      } catch (error) {\r\n        console.error('获取当前叫号情况失败:', error)\r\n      }\r\n    },\r\n\r\n    // 取号\r\n    async getNumber() {\r\n      if (!this.token) {\r\n        alert('请先登录')\r\n        return\r\n      }\r\n      \r\n      if (!this.selectedService) {\r\n        alert('请选择服务')\r\n        return\r\n      }\r\n      \r\n      try {\r\n        this.loading = true\r\n        await axios.post('/api/v1/queue/number', {\r\n          shop_id: this.shopId,\r\n          service_id: this.selectedService\r\n        })\r\n        \r\n        // 更新排队状态\r\n        await this.$store.dispatch('getQueueStatus', this.shopId)\r\n        await this.getCurrentQueue()\r\n        \r\n        alert('取号成功')\r\n      } catch (error) {\r\n        console.error('取号失败:', error)\r\n        alert(error.response?.data?.message || '取号失败')\r\n      } finally {\r\n        this.loading = false\r\n      }\r\n    },\r\n\r\n    // 取消排队\r\n    async cancelQueue() {\r\n      if (confirm('确定要取消当前排队吗？')) {\r\n        try {\r\n          this.loading = true\r\n          await axios.delete('/api/v1/queue/number', {\r\n            data: { shop_id: this.shopId }\r\n          })\r\n          \r\n          // 更新排队状态\r\n          await this.$store.dispatch('getQueueStatus', this.shopId)\r\n          await this.getCurrentQueue()\r\n          \r\n          alert('已取消排队')\r\n        } catch (error) {\r\n          console.error('取消排队失败:', error)\r\n          alert(error.response?.data?.message || '取消排队失败')\r\n        } finally {\r\n          this.loading = false\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.status-card {\r\n  background-color: #fff;\r\n  padding: 20px;\r\n  border-radius: 12px;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.status-text {\r\n  font-size: 24px;\r\n  font-weight: bold;\r\n  margin: 10px 0;\r\n  color: var(--gray-500);\r\n  \r\n  &.active {\r\n    color: var(--primary-color);\r\n  }\r\n}\r\n\r\n.radio-item {\r\n  margin-bottom: 10px;\r\n  display: flex;\r\n  align-items: center;\r\n  \r\n  input {\r\n    margin-right: 10px;\r\n  }\r\n}\r\n\r\n.queue-number {\r\n  font-size: 48px;\r\n  font-weight: bold;\r\n  color: var(--primary-color);\r\n  margin: 15px 0;\r\n}\r\n\r\n.call-container {\r\n  display: flex;\r\n  justify-content: space-around;\r\n  margin: 20px 0;\r\n}\r\n\r\n.call-status {\r\n  text-align: center;\r\n}\r\n\r\n.call-number {\r\n  font-size: 32px;\r\n  font-weight: bold;\r\n  margin-bottom: 5px;\r\n}\r\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}