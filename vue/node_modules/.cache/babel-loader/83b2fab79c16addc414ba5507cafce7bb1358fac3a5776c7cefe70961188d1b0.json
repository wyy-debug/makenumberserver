{"ast":null,"code":"import _regeneratorRuntime from \"/home/makenumberserver/vue/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/home/makenumberserver/vue/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport { createStore } from 'vuex';\nimport axios from 'axios';\nexport default createStore({\n  state: {\n    userInfo: null,\n    shopInfo: null,\n    token: localStorage.getItem('token') || '',\n    baseUrl: '/api/v1',\n    queueData: {\n      hasNumber: false,\n      queueNumber: null,\n      peopleAhead: 0,\n      waitTime: 0\n    },\n    shopId: 1\n  },\n  getters: {\n    isAuthenticated: function isAuthenticated(state) {\n      return !!state.token;\n    },\n    getQueueData: function getQueueData(state) {\n      return state.queueData;\n    },\n    getShopInfo: function getShopInfo(state) {\n      return state.shopInfo;\n    }\n  },\n  mutations: {\n    setUserInfo: function setUserInfo(state, userInfo) {\n      state.userInfo = userInfo;\n    },\n    setToken: function setToken(state, token) {\n      state.token = token;\n      localStorage.setItem('token', token);\n    },\n    clearToken: function clearToken(state) {\n      state.token = '';\n      localStorage.removeItem('token');\n    },\n    setQueueData: function setQueueData(state, queueData) {\n      state.queueData = queueData;\n    },\n    setShopInfo: function setShopInfo(state, shopInfo) {\n      state.shopInfo = shopInfo;\n    }\n  },\n  actions: {\n    login: function login(_ref, code) {\n      var _this = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var commit, dispatch, res, _res$data$data, token, user;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              commit = _ref.commit, dispatch = _ref.dispatch;\n              _context.prev = 1;\n              _context.next = 4;\n              return axios.post(\"\".concat(_this.state.baseUrl, \"/auth/login\"), {\n                code: code\n              });\n            case 4:\n              res = _context.sent;\n              _res$data$data = res.data.data, token = _res$data$data.token, user = _res$data$data.user;\n              commit('setToken', token);\n              commit('setUserInfo', user);\n\n              // 获取店铺信息\n              dispatch('getShopInfo', _this.state.shopId);\n\n              // 获取排队状态\n              dispatch('getQueueStatus', _this.state.shopId);\n              return _context.abrupt(\"return\", user);\n            case 13:\n              _context.prev = 13;\n              _context.t0 = _context[\"catch\"](1);\n              console.error('登录失败:', _context.t0);\n              throw _context.t0;\n            case 17:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, null, [[1, 13]]);\n      }))();\n    },\n    getShopInfo: function getShopInfo(_ref2, shopId) {\n      var _this2 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var commit, res;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              commit = _ref2.commit;\n              _context2.prev = 1;\n              _context2.next = 4;\n              return axios.get(\"\".concat(_this2.state.baseUrl, \"/shops/\").concat(shopId));\n            case 4:\n              res = _context2.sent;\n              commit('setShopInfo', res.data.data);\n              return _context2.abrupt(\"return\", res.data.data);\n            case 9:\n              _context2.prev = 9;\n              _context2.t0 = _context2[\"catch\"](1);\n              console.error('获取店铺信息失败:', _context2.t0);\n              throw _context2.t0;\n            case 13:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, null, [[1, 9]]);\n      }))();\n    },\n    getQueueStatus: function getQueueStatus(_ref3, shopId) {\n      var _this3 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        var commit, res;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              commit = _ref3.commit;\n              if (_this3.state.token) {\n                _context3.next = 3;\n                break;\n              }\n              return _context3.abrupt(\"return\");\n            case 3:\n              _context3.prev = 3;\n              _context3.next = 6;\n              return axios.get(\"\".concat(_this3.state.baseUrl, \"/queue/status\"), {\n                params: {\n                  shop_id: shopId\n                },\n                headers: {\n                  Authorization: \"Bearer \".concat(_this3.state.token)\n                }\n              });\n            case 6:\n              res = _context3.sent;\n              commit('setQueueData', res.data.data);\n              return _context3.abrupt(\"return\", res.data.data);\n            case 11:\n              _context3.prev = 11;\n              _context3.t0 = _context3[\"catch\"](3);\n              console.error('获取排队状态失败:', _context3.t0);\n              throw _context3.t0;\n            case 15:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, null, [[3, 11]]);\n      }))();\n    },\n    // 设置请求拦截器以处理token\n    setupAxios: function setupAxios(_ref4) {\n      var state = _ref4.state,\n        commit = _ref4.commit;\n      axios.interceptors.request.use(function (config) {\n        if (state.token) {\n          config.headers.Authorization = \"Bearer \".concat(state.token);\n        }\n        return config;\n      }, function (error) {\n        return Promise.reject(error);\n      });\n      axios.interceptors.response.use(function (response) {\n        return response;\n      }, function (error) {\n        if (error.response && error.response.status === 401) {\n          commit('clearToken');\n          commit('setUserInfo', null);\n        }\n        return Promise.reject(error);\n      });\n    }\n  }\n});","map":{"version":3,"names":["createStore","axios","state","userInfo","shopInfo","token","localStorage","getItem","baseUrl","queueData","hasNumber","queueNumber","peopleAhead","waitTime","shopId","getters","isAuthenticated","getQueueData","getShopInfo","mutations","setUserInfo","setToken","setItem","clearToken","removeItem","setQueueData","setShopInfo","actions","login","_ref","code","_this","_asyncToGenerator","_regeneratorRuntime","mark","_callee","commit","dispatch","res","_res$data$data","user","wrap","_callee$","_context","prev","next","post","concat","sent","data","abrupt","t0","console","error","stop","_ref2","_this2","_callee2","_callee2$","_context2","get","getQueueStatus","_ref3","_this3","_callee3","_callee3$","_context3","params","shop_id","headers","Authorization","setupAxios","_ref4","interceptors","request","use","config","Promise","reject","response","status"],"sources":["/home/makenumberserver/vue/src/store/index.js"],"sourcesContent":["import { createStore } from 'vuex'\r\nimport axios from 'axios'\r\n\r\nexport default createStore({\r\n  state: {\r\n    userInfo: null,\r\n    shopInfo: null,\r\n    token: localStorage.getItem('token') || '',\r\n    baseUrl: '/api/v1',\r\n    queueData: {\r\n      hasNumber: false,\r\n      queueNumber: null,\r\n      peopleAhead: 0,\r\n      waitTime: 0\r\n    },\r\n    shopId: 1\r\n  },\r\n  getters: {\r\n    isAuthenticated: state => !!state.token,\r\n    getQueueData: state => state.queueData,\r\n    getShopInfo: state => state.shopInfo\r\n  },\r\n  mutations: {\r\n    setUserInfo(state, userInfo) {\r\n      state.userInfo = userInfo\r\n    },\r\n    setToken(state, token) {\r\n      state.token = token\r\n      localStorage.setItem('token', token)\r\n    },\r\n    clearToken(state) {\r\n      state.token = ''\r\n      localStorage.removeItem('token')\r\n    },\r\n    setQueueData(state, queueData) {\r\n      state.queueData = queueData\r\n    },\r\n    setShopInfo(state, shopInfo) {\r\n      state.shopInfo = shopInfo\r\n    }\r\n  },\r\n  actions: {\r\n    async login({ commit, dispatch }, code) {\r\n      try {\r\n        const res = await axios.post(`${this.state.baseUrl}/auth/login`, { code })\r\n        const { token, user } = res.data.data\r\n        commit('setToken', token)\r\n        commit('setUserInfo', user)\r\n        \r\n        // 获取店铺信息\r\n        dispatch('getShopInfo', this.state.shopId)\r\n        \r\n        // 获取排队状态\r\n        dispatch('getQueueStatus', this.state.shopId)\r\n        \r\n        return user\r\n      } catch (error) {\r\n        console.error('登录失败:', error)\r\n        throw error\r\n      }\r\n    },\r\n    \r\n    async getShopInfo({ commit }, shopId) {\r\n      try {\r\n        const res = await axios.get(`${this.state.baseUrl}/shops/${shopId}`)\r\n        commit('setShopInfo', res.data.data)\r\n        return res.data.data\r\n      } catch (error) {\r\n        console.error('获取店铺信息失败:', error)\r\n        throw error\r\n      }\r\n    },\r\n    \r\n    async getQueueStatus({ commit }, shopId) {\r\n      if (!this.state.token) return\r\n      \r\n      try {\r\n        const res = await axios.get(`${this.state.baseUrl}/queue/status`, {\r\n          params: { shop_id: shopId },\r\n          headers: { Authorization: `Bearer ${this.state.token}` }\r\n        })\r\n        commit('setQueueData', res.data.data)\r\n        return res.data.data\r\n      } catch (error) {\r\n        console.error('获取排队状态失败:', error)\r\n        throw error\r\n      }\r\n    },\r\n    \r\n    // 设置请求拦截器以处理token\r\n    setupAxios({ state, commit }) {\r\n      axios.interceptors.request.use(\r\n        config => {\r\n          if (state.token) {\r\n            config.headers.Authorization = `Bearer ${state.token}`\r\n          }\r\n          return config\r\n        },\r\n        error => Promise.reject(error)\r\n      )\r\n      \r\n      axios.interceptors.response.use(\r\n        response => response,\r\n        error => {\r\n          if (error.response && error.response.status === 401) {\r\n            commit('clearToken')\r\n            commit('setUserInfo', null)\r\n          }\r\n          return Promise.reject(error)\r\n        }\r\n      )\r\n    }\r\n  }\r\n}) "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}